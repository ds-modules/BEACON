{"cells":[{"cell_type":"markdown","id":"98c6264d","metadata":{"id":"98c6264d"},"source":["\n","\n","# **BEACO$_{2}$N Notebook 4b: Trends in Background CO$_{2}$ Concentrations**\n","\n","Notebook developed by: *Arushi Sharma, Skye Pickett, Alec Morgan, Lan Dinh, Su Min Park, Amy Castillo, Anna Winter, Ron Cohen*\n","\n","**Contact:** anna_winter@berkeley.edu\n","\n"]},{"cell_type":"markdown","metadata":{"id":"uv0w0xTKIH2b"},"source":["### Learning Outcomes\n","Working through this notebook, you will learn about:\n","1. How the CO$_{2}$ background concentration has been changing since 2016\n","1. Replacing missing values in a DataFrame\n","1. Filtering data\n","1. Creating a new column with a new metric\n","1. Plotting data\n"],"id":"uv0w0xTKIH2b"},{"cell_type":"markdown","source":["## Table of Contents\n","1. Notebook Setup\n","1. Data Filtering\n","1. Plotting Background CO$_{2}$ Measurements\n","1. Conclusion\n","\n","\n","*Note: In this notebook, there may be some more advanced topics that are \"optional\". This means you can just read over these sections; don't worry about fully understanding these parts unless you are really interested. They may be useful later in the course, but for now they are not necessary, so feel free to just skim the parts labelled \"Optional\"!*\n","\n","\n"],"metadata":{"id":"Bupu2q-uEB6r"},"id":"Bupu2q-uEB6r"},{"cell_type":"markdown","source":["<hr style=\"border: 2px solid #003262\">\n","<hr style=\"border: 2px solid #C9B676\">"],"metadata":{"id":"UU-R2iLjb_gC"},"id":"UU-R2iLjb_gC"},{"cell_type":"markdown","id":"bc70cc33","metadata":{"id":"bc70cc33"},"source":["##1. Notebook Setup\n","In the previous *In Class* notebook, we investigated how the background CO$_{2}$ concentration changes throughout the year. We will now look at a longer time series using BEACO$_{2}$N data.\n","\n","You will be exploring the data on your own, but this notebook follows a similar design to the *In Class* notebook. That notebook can be open as a reference as you work through this one!\n","\n"]},{"cell_type":"markdown","metadata":{"id":"cb55ca8d"},"source":["Python requires us to load packages. We'll be using the same packages we loaded in the *In Class* notebook that we went through together. However since this is a separate notebook, we need to load them in again. **Run the cell below.**"],"id":"cb55ca8d"},{"cell_type":"code","execution_count":null,"id":"8ffd5d63","metadata":{"id":"8ffd5d63"},"outputs":[],"source":["# Run this cell\n","\n","# Used for visualizations\n","import matplotlib\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","\n","# Numerical computation\n","import numpy as np\n","from decimal import Decimal\n","\n","# Manipulating data in form of series or dataframes\n","import pandas as pd\n","\n","# Manipulating fields that are date or time\n","import datetime\n","from datetime import time"]},{"cell_type":"markdown","source":["Since we're going to be creating visualizations in this notebook, it can be easiest to set some parameters in advance. Consider this like setting the stage for a show, so everything will be shown in the same view. **Run the cell below.** If any warning pops up, press \"run anyway\".\n","\n","If you get any error saying \"matplotlib is not defined\", that means you haven't run the cell above this. Run that one *first* then the one below next."],"metadata":{"id":"1WDHI2wRs7id"},"id":"1WDHI2wRs7id"},{"cell_type":"code","execution_count":null,"id":"cb00b646","metadata":{"id":"cb00b646"},"outputs":[],"source":["# Using this cell, we will be defining some matplotlib parameters for the plots that we will be creating.\n","\n","matplotlib.rcParams['axes.linewidth'] = 1\n","matplotlib.rcParams['lines.linewidth'] = 3\n","matplotlib.rcParams['ytick.labelsize'] = 20\n","matplotlib.rcParams['xtick.labelsize'] = 20\n","matplotlib.rcParams['axes.titlesize'] = 20\n","matplotlib.rcParams['axes.labelsize'] = 20\n","plt.rcParams['figure.figsize'] = [20, 14]\n","plt.rcParams[\"axes.labelweight\"] = \"bold\"\n","np.set_printoptions(suppress=True)\n","plt.rcParams[\"axes.labelweight\"] = \"bold\"\n","plt.rcParams[\"savefig.facecolor\"]= '#FFFFFF'"]},{"cell_type":"markdown","source":["**We will now load in data from several BEACO$_{2}$N sites from 2016-2024.**"],"metadata":{"id":"0SBpO4eUv6Od"},"id":"0SBpO4eUv6Od"},{"cell_type":"code","execution_count":null,"id":"78e8ca12","metadata":{"id":"78e8ca12"},"outputs":[],"source":["# Pulling the CO2 data from several BEACO2N sites\n","CO2_data = 'https://github.com/wintera71/BEACO2N-Modules/raw/refs/heads/main/Lesson%204:%20The%20Carbon%20Cycle/CSVs/CO2_vals_multiyear.csv'\n","\n","CO2_vals = pd.read_csv(CO2_data, on_bad_lines='skip', index_col = [0], parse_dates=[0])"]},{"cell_type":"markdown","source":["Now, to replicate what we did with this data in the In Class notebook, let's **replace the data marked as -999 and -111 with NaN values using the `.replace` function** in the cell below.\n","\n","**Q1: Replace the `...` with your code.**\n","\n","*Note: If you don't know what -999 and -111 are, take a look at the in-class notebook for detailed explanation!*"],"metadata":{"id":"L7KHoe9OwAof"},"id":"L7KHoe9OwAof"},{"cell_type":"code","execution_count":null,"id":"496e7b89","metadata":{"id":"496e7b89"},"outputs":[],"source":["# Run this cell\n","# Replacing flagged values with NaNs\n","\n","\n","CO2_vals = CO2_vals.replace(...)\n","CO2_vals = CO2_vals.replace(...)"]},{"cell_type":"markdown","source":["*If you get an error that `CO2_vals` isn't defined, the above cell that defines `CO2_vals` (`CO2_vals = ...`) hasn't been run or hasn't finished running yet.*"],"metadata":{"id":"bbK8yuK3fg_O"},"id":"bbK8yuK3fg_O"},{"cell_type":"markdown","source":["***\n","##2. Data Filtering\n","\n","Now that we have cleaned our data, let's take a look at our DataFrame `CO2_vals`.\n","\n","**Q2: In the cell below, use the `head` function to display the first *5* rows of our `CO2_vals` DataFrame.**"],"metadata":{"id":"hgiVjCivOYfF"},"id":"hgiVjCivOYfF"},{"cell_type":"code","execution_count":null,"id":"7595e14d","metadata":{"id":"7595e14d"},"outputs":[],"source":["## Q2 Your Code Here\n"]},{"cell_type":"markdown","source":["<br>To get an idea of the background concentration, let's pull the 10th percentile of these measurements at every time step.\n","\n","**Q3: Create a column in the `CO2_vals` DataFrame called `'tenth_per'` that pulls the 10th percentile at every time step.** This is a little tricky, but it is similar to what we did together!\n","\n",">This is the format the 1st line of your code should follow:<br>\n","**`<dataframe_name>[<\"new_column_name\">]` = `<dataframe_name>.quantile(q=0.1, axis=1, numeric_only=True, interpolation='linear')`**\n","<br>*Feel free to copy and paste the above code into your code cell, then modify everything in **`< >`**.*\n","\n",">Your second line of code should **display the first 5 rows** of the updated `CO2_vals` DataFrame like we did above. Ensure that the column, **`tenth_per` shows up** when you run the cell!"],"metadata":{"id":"LeE5ZGY9wFZw"},"id":"LeE5ZGY9wFZw"},{"cell_type":"code","execution_count":null,"id":"b744c523","metadata":{"id":"b744c523"},"outputs":[],"source":["# Pull the 10th percentile of the measurements at every time step.\n","# Q3 YOUR CODE HERE\n","\n"]},{"cell_type":"markdown","source":["Great work! Now that we've seen that CO$_{2}$ concentrations are different in the day and night in the *In Class* notebook, we'll do the same filtering with our larger dataset here. In the code cell below, we will manipulate the `CO2_vals` DataFrame to work with only the daytime hours. <br>**Just run the cell below.**<br>\n","*Note: We are following the same process as before. However, recall that this time our `CO2_vals` DataFrame has much more data that encompasses a larger span of time!*"],"metadata":{"id":"FyTwNaN2wMgL"},"id":"FyTwNaN2wMgL"},{"cell_type":"code","execution_count":null,"id":"2997988e","metadata":{"id":"2997988e"},"outputs":[],"source":["# RUN THIS CELL to filter data for just the daytime hours\n","\n","# Adding in an hour of day column\n","CO2_vals['hour'] = CO2_vals.index.time\n","\n","# Filtering to times between 10:00 AM and 4:00 PM\n","CO2_vals_filtered = CO2_vals.loc[(CO2_vals['hour'] >= time(10,00)) & (CO2_vals['hour'] <= time(16,00))]\n","\n","# Dropping the hour column from the dataframe\n","CO2_vals_filtered = CO2_vals_filtered.drop('hour', axis = 1)"]},{"cell_type":"markdown","source":["Now we have a filtered dataset, called **`CO2_vals_filtered`**, and this dataset has *only* the rows that contain timestamps reflective of **daytime hours.** <br>\n","***\n","##3. Plotting Background CO$_{2}$ Measurements\n","\n","**Now it's your turn to plot the data!**<br> Plot the CO$_{2}$ time series to explore how CO$_{2}$ concentrations are changing over time. Because the data is noisy, we've provided a smoothed version that makes the resulting plot clearer and easier to read. You don't need to understand the code in the cell below.\n","\n"],"metadata":{"id":"arPjq6JBwQ9B"},"id":"arPjq6JBwQ9B"},{"cell_type":"code","source":["## Run this cell\n","CO2_plot_means = CO2_vals_filtered.rolling(window = 24*14, min_periods = 24*6, center = True).mean() # given to students\n"],"metadata":{"id":"ZESc6GuOiddh"},"id":"ZESc6GuOiddh","execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["\n","**Q4: Replace the `...` with your code below. Plot the `tenth_per` column from the `CO2_plot_means` DataFrame made for you above. Add an x-axis label and y-axis label to the plot.**\n","> Your code to create your plot should look like this (*feel free to copy and paste*):<br>\n","`plt.plot(<dataframe_name>.index, <dataframe_name>['<column_name>']`"],"metadata":{"id":"ueFRN-ciicyl"},"id":"ueFRN-ciicyl"},{"cell_type":"code","source":["plt.figure(figsize = (30, 8))\n","\n","...\n","\n","# Add a x-axis label\n","plt.xlabel(...)\n","\n","# Add a y-axis label (include units!)\n","plt.ylabel(...)\n","\n","# Adds a title\n","plt.title(\"BEACO2N Background CO2 Concentrations\")"],"metadata":{"id":"a72BMYwzPwOu"},"id":"a72BMYwzPwOu","execution_count":null,"outputs":[]},{"cell_type":"markdown","id":"f39f0512","metadata":{"id":"f39f0512"},"source":["Look at the plot above to answer each of the following questions:<br>\n","\n","* **Q5:** What is the lowest CO$_{2}$ value seen in the plot and when did it occur? (Approximate the CO$_{2}$ concentration and the month/season of the year that it occured.)\n","*   **Q6:** Approximately how much time passes between each dip in the graph?\n","* **Q7:** What is the highest CO$_{2}$ value seen in the plot and when did it occur? (Approximate the CO$_{2}$ concentration and the month/season of the year that it occured.)\n","* **Q8:** What overall trend do you see in the data? What are some factors that could be contributing to this?\n"]},{"cell_type":"markdown","source":["**Double-click to edit this cell with your answers:**<br>\n","\n","*   **Q5:** (Your answer here)\n","*   **Q6:** (Your answer here)\n","*   **Q7:** (Your answer here)\n","*   **Q8:** (Your answer here)"],"metadata":{"id":"uEGGWw1jNBTz"},"id":"uEGGWw1jNBTz"},{"cell_type":"markdown","source":["***\n","##4. Conclusion\n","In this notebook, you learned about:\n","- Filtering data\n","- Replacing missing values using `.replace`\n","- Creating a new column in a DataFrame\n","- Plotting CO$_{2}$ concentration values\n","- Interpretting the range and period of a plot\n","\n","#### You've finished **The Carbon Cycle *Student Exploration* notebook**. Good job! Congratulations on finishing **The Carbon Cycle** lesson!"],"metadata":{"id":"XzmYlyJil1Du"},"id":"XzmYlyJil1Du"},{"cell_type":"markdown","source":["***\n","***"],"metadata":{"id":"63DW7Ddomh0C"},"id":"63DW7Ddomh0C"}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.7"},"colab":{"provenance":[{"file_id":"1rBHB6WGNGKqborYN7a2P7G0WyRGeMiJ-","timestamp":1708299839068}]}},"nbformat":4,"nbformat_minor":5}