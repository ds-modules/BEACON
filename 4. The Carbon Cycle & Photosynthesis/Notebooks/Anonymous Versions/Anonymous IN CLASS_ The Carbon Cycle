{"cells":[{"cell_type":"markdown","id":"fc1ccfb7","metadata":{"id":"fc1ccfb7"},"source":["# **BEACO$_{2}$N Notebook 4a: The Northen Hemisphere CO$_{2}$ Seasonal Cycle**"]},{"cell_type":"markdown","metadata":{"id":"uv0w0xTKIH2b"},"source":["### Learning Outcomes\n","Working through this notebook, you will learn about:\n","1. Background CO$_{2}$ concentration in the Bay Area and seasonal patterns\n","1. Identifying and representing missing values\n","1. Filtering data\n"],"id":"uv0w0xTKIH2b"},{"cell_type":"markdown","source":["## Table of Contents\n","1. Preview and Notebook Setup  \n","> 1.1 Objective  <br>\n","> 1.2 Setting Up Our Notebook  <br>\n","\n","2. CO$_{2}$ Seasonal Cycle in the Bay Area  \n","> 2.1 Keeling Curve  <br>\n","> 2.2 CO$_{2}$ Concentrations from BEACO$_{2}$N Sites  <br>\n","\n","3. Exploratory Data Analysis  \n","> 3.1 10th Percentile  <br>\n","> 3.2 Filtering to Daytime Hours  <br>\n","> 3.3 Plotting the Background CO$_{2}$ Concentrations <br>\n","\n","\n","*Note: In this notebook, there may be some more advanced topics that are \"optional\". This means you can just read over these sections; don't worry about fully understanding these parts unless you are really interested. They may be useful later in the course, but for now they are not necessary, so feel free to just skim the parts labelled \"Optional\"!*\n"],"metadata":{"id":"TrAuSzD2lDog"},"id":"TrAuSzD2lDog"},{"cell_type":"markdown","source":["<hr style=\"border: 2px solid #003262\">\n","<hr style=\"border: 2px solid #C9B676\">"],"metadata":{"id":"GoMKqXNiT7hp"},"id":"GoMKqXNiT7hp"},{"cell_type":"markdown","id":"2e77e426","metadata":{"id":"2e77e426"},"source":["\n","##1. Preview and Notebook Setup\n","\n"]},{"cell_type":"markdown","source":["####1.1 Objective\n","In our analysis, we will be observing the Northern Hemisphere CO$_{2}$ cycle. We will be using BEACO$_{2}$N data ([source](http://beacon.berkeley.edu/)) to answer the following question: <BR>**How does the background CO$_{2}$ concentration change throughout the year?**"],"metadata":{"id":"WvW7JyVyQqN8"},"id":"WvW7JyVyQqN8"},{"cell_type":"markdown","source":["#### 1.2 Setting Up Our Notebook\n","In this notebook, you'll be using the library we learned about in a previous notebook, pandas, to manipulate DataFrames and understand large amounts of data.\n","\n","*Reminder:* Pandas is a popular open-source Python library used to work with and analyze data. It makes it easy to organize, explore, and change data that is set up in a table-like format.\n","\n"],"metadata":{"id":"jKgKhViSli4F"},"id":"jKgKhViSli4F"},{"cell_type":"markdown","metadata":{"id":"cb55ca8d"},"source":["Let's start by loading some packages we will need. Most of these we've learned about in our last two notebooks! Remember that they need to imported in any notebook we want to work in. **Run the cell below to import them.**\n","\n",">*Reminder:* To run a cell...\n","* Click the **Play icon** in the left gutter of the cell **OR**\n","* Click **Shift+Enter** or **Shift+Return** on your computer keyboard to run the cell and move focus to the next cell"],"id":"cb55ca8d"},{"cell_type":"code","execution_count":null,"id":"830a8126","metadata":{"id":"830a8126"},"outputs":[],"source":["# Run this cell\n","\n","# Used for visualizations\n","import matplotlib\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","\n","# Numerical computation\n","import numpy as np\n","from decimal import Decimal\n","\n","# Manipulating data in form of series or dataframes\n","import pandas as pd\n","\n","# Manipulating fields that are date or time\n","import datetime\n","from datetime import time"]},{"cell_type":"markdown","source":["Since we're going to be creating visualizations in this notebook, it can be easiest to set some parameters in advance. Consider this like setting the stage for a show, so everything will be shown in the same view. **Run the cell below.** If any warning pops up, press \"run anyway\".\n","\n","If you get any error saying \"matplotlib is not defined\", that means you haven't run the cell above this. Run that one *first* then the one below next."],"metadata":{"id":"1WDHI2wRs7id"},"id":"1WDHI2wRs7id"},{"cell_type":"code","execution_count":null,"id":"ecc9c952","metadata":{"id":"ecc9c952"},"outputs":[],"source":["# Using this cell, we will be defining some matplotlib parameters for the plots that we would be creating.\n","matplotlib.rcParams['axes.linewidth'] = 1\n","matplotlib.rcParams['lines.linewidth'] = 3\n","matplotlib.rcParams['ytick.labelsize'] = 20\n","matplotlib.rcParams['xtick.labelsize'] = 20\n","matplotlib.rcParams['axes.titlesize'] = 20\n","matplotlib.rcParams['axes.labelsize'] = 20\n","plt.rcParams['figure.figsize'] = [20, 14]\n","plt.rcParams['axes.labelweight'] = 'bold'\n","np.set_printoptions(suppress=True)\n","plt.rcParams['axes.labelweight'] = 'bold'\n","plt.rcParams['savefig.facecolor']= '#FFFFFF'"]},{"cell_type":"markdown","id":"a4a7ec1b","metadata":{"id":"a4a7ec1b"},"source":["***\n","##2. CO$_{2}$ Seasonal Cycle in the Bay Area\n","###2.1 Keeling Curve"]},{"cell_type":"markdown","id":"d4aaa8b0","metadata":{"id":"d4aaa8b0"},"source":["The **\"Keeling Curve\"** refers to a graph that shows the ongoing *increase* of carbon dioxide (CO$_{2}$) levels in the Earth's atmosphere over time. It is named after Charles David Keeling, an American scientist who began measurements of atmospheric CO$_{2}$ concentrations at the Mauna Loa Observatory in Hawaii in 1958. Check out the Keeling Curve below:\n","\n","![Keeling Curve](https://raw.githubusercontent.com/wintera71/BEACO2N-Modules/main/Lesson%204%3A%20The%20Carbon%20Cycle/CSVs/Keeling%20Curve.png)\n","Source: [Keeling Curve](https://keelingcurve.ucsd.edu/)\n","\n","\n","\n","\n","The Keeling Curve is an important tool in studying the long-term trend of CO$_{2}$ concentrations and its correlation with climate change. **It shows a consistent upward trend in CO$_{2}$ concentrations with seasonal variations, reflecting the influence of natural processes such as photosynthesis in the Northern Hemisphere during the summer months.** The overall increase in CO$_{2}$ concentrations is **primarily attributed to *human activities*** like the burning of fossil fuels and deforestation.\n","<br>\n","<br>\n","###2.2 CO$_{2}$ Concentration from BEACO$_{2}$N Sites\n","\n","This trend has been observed at the Mauna Loa Observatory, and we can analyze the seasonal cycle *in the Bay Area* too! **Let's pull data from multiple BEACO$_{2}$N sites to find the background CO$_{2}$ concentration in the Bay Area.**\n","\n","We have already pulled this data in a CSV file. Let's read it in and take a look at the pandas DataFrame where each column is a different site in the network."]},{"cell_type":"code","source":["CO2_data = 'https://github.com/wintera71/BEACO2N-Modules/raw/refs/heads/main/Lesson%204:%20The%20Carbon%20Cycle/CSVs/CO2_vals.csv'"],"metadata":{"id":"lkFrENZUc80S"},"id":"lkFrENZUc80S","execution_count":null,"outputs":[]},{"cell_type":"code","source":["CO2_vals  = pd.read_csv(CO2_data, on_bad_lines='skip', index_col = [0], parse_dates=[0])"],"metadata":{"id":"qShYeybKc8JL"},"id":"qShYeybKc8JL","execution_count":null,"outputs":[]},{"cell_type":"code","source":["CO2_vals"],"metadata":{"id":"eBnZBAX5dcwr"},"id":"eBnZBAX5dcwr","execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["####2.2.1 Investigation\n","To start off, let's investigate our `CO2_vals` table!\n","\n","The function `sort_values(<column_name>)` sorts values of a DataFrame based on whatever column is specified in the parentheses. In the cell below, we'll practice this by sorting the rows in order of the values of Node 47 (the column `47`).\n","\n","**Can you spot any strange values in the DataFrame below?**\n","\n","*Hint: Take a closer look at the column `47`.*"],"metadata":{"id":"Rygkn9PiB75Z"},"id":"Rygkn9PiB75Z"},{"cell_type":"code","source":["CO2_vals.sort_values(\"47\")"],"metadata":{"id":"BtiX7U_rEeJD"},"id":"BtiX7U_rEeJD","execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["####2.2.2 Missing Values\n","Hopefully you spotted the values that are all `-999.0` and `NaN`. Some of the values contain -999 as a CO$_{2}$ concentration value, which is an invalid input since a concentration can't be negative. In reality, -999 is a very common number used to represent missing values. Other common numbers used for missing values include -9999, -1111, -111, and so on.\n","\n","In practice, we want to exclude these numbers from our dataset, as they can significantly impact calculations such as averages or summations. When we make calculations, they get treated as correct values and a value like -999 would skew our statistics significantly. Therefore, we will replace these numbers that represent missing data with the NaN value, a more suitable representation for missing data. This is much preferred because `NaN` is treated as it's own type, not as a number to include in the calculation."],"metadata":{"id":"jNrvou6P8tIN"},"id":"jNrvou6P8tIN"},{"cell_type":"markdown","id":"7e069919","metadata":{"id":"7e069919"},"source":["####2.2.3 Modifying Missing Values\n","Let's **filter out any data that is marked as missing** in the cell below! The **`replace{<original>:<new>}`** function replaces all values that match <original> with <new>. Thus, in this case, the first line below replaces all values in the DataFrame that are -999 with NaN. The second line replaces all values in the DataFrame that are -111 with NaN."]},{"cell_type":"code","execution_count":null,"id":"ee731d4b","metadata":{"id":"ee731d4b"},"outputs":[],"source":["# Replacing flagged values with NaNs\n","CO2_vals = CO2_vals.replace({-999:np.nan})\n","CO2_vals = CO2_vals.replace({-111:np.nan})"]},{"cell_type":"markdown","id":"85d6ecfb","metadata":{"id":"85d6ecfb"},"source":["Now let's take a look at our updated DataFrame. Be sure you ran the cell above this! The **.head(5)** command will show the first 5 rows."]},{"cell_type":"code","execution_count":null,"id":"151e7c23","metadata":{"id":"151e7c23"},"outputs":[],"source":["CO2_vals.head(5)"]},{"cell_type":"markdown","id":"31c3c34b","metadata":{"id":"31c3c34b"},"source":["***\n","##3. Exploratory Data Analysis\n","\n","###3.1 10th Percentile\n","\n","To get an idea of the background concentration, let's pull the 10th percentile of all of these measurements at every time step. This means we are finding the concentrations of CO$_{2}$ that are lower than 90% of the data. Why is this useful? It helps us ignore sudden spikes in CO$_{2}$ from things like cars driving by or nearby sources. By focusing on the lower values, we get a better sense of the \"background\" CO$_{2}$ concentrations in the Bay Area- the amount that is usually in the air even without these local influences.\n","\n","\n","We'll store these values in a column called `tenth_per` in the DataFrame. In the code cell below, we create the new column by writing **`CO2_vals['tenth_per']`** which follows this syntax: `<DataFrame_name>[\"<new_column_name>\"]`. The code to the right of the `=` is a bit more complicated than you need to know, but it does the 10th percentile computation! <br>**Run the cell below and notice the new column that was added at the right, `tenth_per`!**"]},{"cell_type":"code","execution_count":null,"id":"0a3fd17f","metadata":{"id":"0a3fd17f"},"outputs":[],"source":["CO2_vals['tenth_per'] = CO2_vals.quantile(q=0.10, axis=1, numeric_only=True, interpolation='linear')\n","CO2_vals.head(5)"]},{"cell_type":"markdown","id":"a4e89720","metadata":{"id":"a4e89720"},"source":["###3.2 Filtering to Daytime only\n","CO$_{2}$ concentrations are different at day and night. To better estimate background concentrations, we'll focus on just the daytime hours when the atmosphere is better mixed and less affected by local buildup. Let's filter our `CO2_vals` DataFrame to look at just the daytime hours. We do this by using the column with information on time, `local_timestamp`, and filter the hours to be between 10am (10:00) and 4pm (16:00). **Run the cell below!** *Don't worry about understanding the code itself, just why we're doing what we are!*"]},{"cell_type":"code","execution_count":null,"id":"f7435014","metadata":{"id":"f7435014"},"outputs":[],"source":["# Adding in an hour of day column:\n","CO2_vals['hour'] = CO2_vals.index.time\n","\n","# Filtering to times between 10:00 AM and 4:00 PM\n","CO2_vals_filtered = CO2_vals.loc[(CO2_vals['hour'] >= time(10,00)) & (CO2_vals['hour'] <= time(16,00))]\n","\n","# Dropping the hour column from the dataframe\n","CO2_vals_filtered = CO2_vals_filtered.drop('hour', axis = 1)"]},{"cell_type":"markdown","id":"50e4c63b","metadata":{"id":"50e4c63b"},"source":["###3.3 Plotting the Bay Area Background CO$_{2}$ Concentration\n","Now that we've made a new version of `CO2_vals` and called it `CO2_vals_filtered`, there are fewer rows, but looking purely at a DataFrame is still a whole lot to comprehend wholistically! Let's plot the data in a graph so we can see a visual representation!\n","\n","**Run the cell below! Take a look through the code and make sure you understand what's happening. We worked on plotting in this same way in the Wildfire notebooks and you'll be doing more of this in the *Student Exploration* notebook too!**\n","\n","Here we plot **two lines**, one with *all* the values in the `tenth_per` column and one that smooths out the plot using the `.rolling` function to help us see the trend. Ensure you know how to make the first plot!"]},{"cell_type":"code","execution_count":null,"id":"6b8dd1b6","metadata":{"id":"6b8dd1b6"},"outputs":[],"source":["plt.figure(figsize = (15, 8))\n","\n","# Creates two lineplots\n","plt.plot(CO2_vals_filtered['tenth_per'], color = 'black', label = \"Network 10th Percentile\")\n","plt.plot(CO2_vals_filtered['tenth_per'].rolling(window=24*14, min_periods=24*6, center=True).mean(), color = 'red', label = 'Rolling Mean')\n","\n","# Adds a x-axis label\n","plt.xlabel(\"Date\")\n","\n","# Adds a y-axis label\n","plt.ylabel(\"CO2 Concentration (ppm)\")\n","\n","# Adds a title to our line plot\n","plt.title(\"Bay Area Background CO2 Concentration\")\n","\n","# Adds a legend\n","plt.legend(loc = 'upper left');"]},{"cell_type":"markdown","id":"b2e66622","metadata":{"id":"b2e66622"},"source":["**Let's make some observations:**<br>**1. During what month(s) were the lowest background CO$_{2}$ concentration values found?**<br> **2. During what month(s) were the highest background CO$_{2}$ concentration values found?**<br> **3. What is one natural phenomena that can explain this? (You might need to do a Google search)**\n","<br>*Write your answer in the cell below. Reminder: \"2021-05\" for example means the 5th month of 2021 --> May 2021.*"]},{"cell_type":"markdown","source":["*Double-click to edit this cell and replace the below text with your answer.*\n","1. (Your response here)\n","2. (Your response here)\n","3. (Your response here)"],"metadata":{"id":"Sn2kpjbj_m0b"},"id":"Sn2kpjbj_m0b"},{"cell_type":"markdown","source":["***\n","#### You've finished with **The Carbon Cycle *In Class* notebook** and are ready to begin **The Carbon Cycle *Student Exploration* notebook**! Good job!"],"metadata":{"id":"kwQQlV3dQFvq"},"id":"kwQQlV3dQFvq"}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.7"},"colab":{"provenance":[{"file_id":"18oR4PBIMR-zslgpy2Ag-h8Y-AXzKT5hu","timestamp":1695347717813}]}},"nbformat":4,"nbformat_minor":5}