{"cells":[{"cell_type":"markdown","id":"06415164","metadata":{"id":"06415164"},"source":["# **BEACO$_{2}$N Notebook 5a: Highways and Pollutants**\n","\n","Notebook developed by: *Arushi Sharma, Skye Pickett, Alec Morgan, Lan Dinh, Su Min Park, Amy Castillo, Anna Winter, Ron Cohen*\n","\n","**Contact:** anna_winter@berkeley.edu\n"]},{"cell_type":"markdown","metadata":{"id":"uv0w0xTKIH2b"},"source":["### Learning Outcomes\n","Working through this notebook, you will learn about:\n","1. NO and NO$_{2}$ concentrations at locations close to and far from highways\n","1. The Weekend Effect\n","1. Plotting time series data\n","1. DateTime in pandas\n","1. Using `groupby` to summarize data\n"],"id":"uv0w0xTKIH2b"},{"cell_type":"markdown","source":["## Table of Contents\n","\n","1. Predictions and Notebook Setup  \n","> 1.1 Topic Introduction: Highway Pollution  <br>\n","> 1.2 Notebook Setup  <br>\n","\n","2. NOx Concentration Time Series  \n","> 2.1 NO Concentrations  <br>\n","> 2.2 NO$_{2}$ Concentrations  <br>\n","\n","3. The Weekend Effect  \n","> 3.1 Splitting DataFrames into Weekend and Weekdays  <br>\n","> 3.2 Averaging Concentrations  <br>\n","> 3.3 Plotting Concentrations  <br>\n","\n","\n","*Note: In this notebook, there are some more advanced topics that are \"optional\". This means you can just read over these sections; don't worry about fully understanding these parts unless you are really interested. They may be useful later in the course, but for now they are not necessary, so feel free to just skim the parts labelled \"Optional\"!*"],"metadata":{"id":"0uUODjhXNkdc"},"id":"0uUODjhXNkdc"},{"cell_type":"markdown","source":["<hr style=\"border: 2px solid #003262\">\n","<hr style=\"border: 2px solid #C9B676\">"],"metadata":{"id":"kOt2F9QSjZp6"},"id":"kOt2F9QSjZp6"},{"cell_type":"markdown","id":"e3df9f8e","metadata":{"id":"e3df9f8e"},"source":["##1. Predictions and Notebook Setup\n","###1.1 Topic Introduction: Highway Pollution\n","In this notebook, we'll take a look at NO and NO$_{2}$ concentrations collected at **two BEACO$_{2}$N sites - one close to the highway, and one far away from the highway.** We'll look at a time series of concentrations at both sites. <br>Take a moment and **predict how the highway will affect both NO and NO$_{2}$ concentrations, and give an explanation for your prediction.**\n","\n"]},{"cell_type":"markdown","source":["**YOUR PREDICTION HERE:**<br>\n","*Double click on this text cell to edit this cell and replace this sentence\n","with your ideas.*\n"],"metadata":{"id":"k-hBGNIeP4m5"},"id":"k-hBGNIeP4m5"},{"cell_type":"markdown","source":["**Another consideration:**<br>The number of heavy duty trucks on the road significantly **decreases** on the weekends. As trucks are a major source of NOx (NO + NO$_{2}$), **NOx  concentrations decrease on the weekends**. This is known as the \"***Weekend Effect***\". In this notebook, we'll also take a look at how *highways* affect the *Weekend Effect*."],"metadata":{"id":"GNbY3wV7PwDw"},"id":"GNbY3wV7PwDw"},{"cell_type":"markdown","metadata":{"id":"cb55ca8d"},"source":["###1.2 Notebook Setup\n","####1.2.1 Importing Packages\n","Let's start by loading some packages we will need. Most of these we've learned about in our last two notebooks! Remember that they need to imported in any notebook we want to work in. **Run the cell below to import them.**\n","\n",">*Reminder:* To run a cell...\n","* Click the **Play icon** in the left gutter of the cell **OR**\n","* Click **Shift+Enter** or **Shift+Return** on your computer keyboard to run the cell and move focus to the next cell"],"id":"cb55ca8d"},{"cell_type":"code","execution_count":null,"id":"ddfc74cf","metadata":{"id":"ddfc74cf"},"outputs":[],"source":["# Packages used for visualizations\n","import matplotlib\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","\n","# Numerical computation\n","import numpy as np\n","from decimal import Decimal\n","\n","# Manuplating data in form of series or dataframes\n","import pandas as pd\n","\n","# Manipulating fields that are date or time\n","import datetime\n","from datetime import time"]},{"cell_type":"markdown","source":["Since we're going to be creating visualizations in this notebook, it can be easiest to set some parameters in advance. Consider this like setting the stage for a show, so everything will be shown in the same view. **Run the cell below.** If any warning pops up, press \"run anyway\".\n","\n","If you get any error saying \"matplotlib is not defined\", that means you haven't run the cell above this. Run that one *first* then the one below next."],"metadata":{"id":"1WDHI2wRs7id"},"id":"1WDHI2wRs7id"},{"cell_type":"code","execution_count":null,"id":"d53f6727","metadata":{"id":"d53f6727"},"outputs":[],"source":["# Using this cell, we will be defining some matplotlib parameters for the plots that we will be creating.\n","matplotlib.rcParams['axes.linewidth'] = 1\n","matplotlib.rcParams['lines.linewidth'] = 3\n","matplotlib.rcParams['ytick.labelsize'] = 20\n","matplotlib.rcParams['xtick.labelsize'] = 20\n","matplotlib.rcParams['axes.titlesize'] = 20\n","matplotlib.rcParams['axes.labelsize'] = 20\n","plt.rcParams['figure.figsize'] = [20, 14]\n","plt.rcParams[\"axes.labelweight\"] = \"bold\"\n","np.set_printoptions(suppress=True)\n","plt.rcParams[\"axes.labelweight\"] = \"bold\"\n","plt.rcParams[\"savefig.facecolor\"]= '#FFFFFF'"]},{"cell_type":"markdown","id":"27189423","metadata":{"id":"27189423"},"source":["####1.2.2 Importing Data\n","Now we will load in data from two [BEACO$_{2}$N](http://beacon.berkeley.edu/about/) sites: *Laney* and *San Pablo*. <br>**Laney is only *40 meters* from the highway, while San Pablo is much farther away at *2.3 kilometers* from the highway.**"]},{"cell_type":"markdown","id":"34b5db5c","metadata":{"id":"34b5db5c"},"source":["Let's load in the data from the Laney site first: ***Run the cell below***"]},{"cell_type":"code","execution_count":null,"id":"ffcdfd64","metadata":{"id":"ffcdfd64"},"outputs":[],"source":["## Laney data\n","filename_close =\"https://github.com/wintera71/BEACO2N-Modules/raw/refs/heads/main/Lesson%205:%20Air%20Pollutant%20Exposure/CSVs/data_close.csv\"\n","data_close  = pd.read_csv(filename_close, on_bad_lines='skip', index_col = [0], parse_dates=[0])\n","data_close['nox'] = data_close['no'] + data_close['no2']\n","data_close[:10]"]},{"cell_type":"markdown","source":["We saved the data from the Laney site in a DataFrame called **`data_close`** since it is ***closer* to the highway**."],"metadata":{"id":"upfVtvErTMNM"},"id":"upfVtvErTMNM"},{"cell_type":"code","source":["data_close.head(5)"],"metadata":{"id":"E0oLrl8nTKuc"},"id":"E0oLrl8nTKuc","execution_count":null,"outputs":[]},{"cell_type":"markdown","id":"b3da82ee","metadata":{"id":"b3da82ee"},"source":["Now, let's load in the data from the San Pablo site: ***Run the cell below***"]},{"cell_type":"code","execution_count":null,"id":"61f7cd7c","metadata":{"id":"61f7cd7c"},"outputs":[],"source":["## San Pablo data\n","filename_far ='https://github.com/wintera71/BEACO2N-Modules/raw/refs/heads/main/Lesson%205:%20Air%20Pollutant%20Exposure/CSVs/data_far.csv'\n","data_far  = pd.read_csv(filename_far, on_bad_lines='skip', index_col = [0], parse_dates=[0])\n","data_far['nox'] = data_far['no'] + data_far['no2']\n","data_far[:10]"]},{"cell_type":"markdown","source":["We saved the data from the San Pablo site in a DataFrame called **`data_far`** since it is ***farther* from the highway**."],"metadata":{"id":"UHlkLoY4TpHR"},"id":"UHlkLoY4TpHR"},{"cell_type":"code","source":["data_far.head(5)"],"metadata":{"id":"5gY4gYJ4Tm4g"},"id":"5gY4gYJ4Tm4g","execution_count":null,"outputs":[]},{"cell_type":"markdown","id":"983ee27d","metadata":{"id":"983ee27d"},"source":["***\n","##2. NOx Concentration Time Series\n","Now that we have the data loaded, let's take a look at a time series of both NO and NO$_{2}$ concentrations. We'll start with NO.\n","\n","###2.1 NO Concentrations\n","Read through each line of the cell below to understand what makes the produced visualization."]},{"cell_type":"code","source":["data_close.index"],"metadata":{"id":"dz_WmSp32WTb"},"id":"dz_WmSp32WTb","execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"id":"78e27020","metadata":{"id":"78e27020"},"outputs":[],"source":["plt.figure(figsize = (25, 8)) # indicates figure size\n","plt.plot(data_close.index, data_close['no'], label = 'Near Highway') # plotting Laney site data\n","plt.plot(data_far.index, data_far['no'], label = 'Far From Highway') # plotting San Pablo site data\n","plt.legend(fontsize = 20) # indicates font size of legend\n","plt.xlabel(\"Date\") # label for x axis\n","plt.ylabel(\"NO Concentration (ppb)\") # label for y axis\n","plt.title(\"NO Concentration Time Series\"); # title of graph"]},{"cell_type":"markdown","source":["This is useful for making any comparisons between two variables!"],"metadata":{"id":"j3EwLEYV2TAB"},"id":"j3EwLEYV2TAB"},{"cell_type":"markdown","id":"268bfeb3","metadata":{"id":"268bfeb3"},"source":["**What do you observe?** Write a few sentences considering these 2 questions:<br>\n","> 1. How do highways affect NO concentrations?\n","> 2. Why do highways have this effect on NO concentrations?"]},{"cell_type":"markdown","source":["**Your answer:**<br>\n","Double-click on this cell and replace this text with your response."],"metadata":{"id":"N7aW_0gAU1oF"},"id":"N7aW_0gAU1oF"},{"cell_type":"markdown","id":"26cd8614","metadata":{"id":"26cd8614"},"source":["###2.2 NO$_{2}$ Concentrations\n","Now let's take a look at NO$_{2}$ concentrations. Read through each line of the cell below to understand what makes the produced visualization."]},{"cell_type":"code","execution_count":null,"id":"ce76e46d","metadata":{"id":"ce76e46d"},"outputs":[],"source":["plt.figure(figsize = (25, 8))  # indicates figure size\n","plt.plot(data_close.index, data_close['no2'], label = 'Near Highway')  # plotting Laney site data\n","plt.plot(data_far.index, data_far['no2'], label = 'Far From Highway') # plotting San Pablo site data\n","plt.legend(fontsize = 20)  # indicates font size of legend\n","plt.xlabel(\"Date\") # label for x axis\n","plt.ylabel(\"NO2 Concentration (ppb)\") # label for y axis\n","plt.title(\"NO2 Concentration Time Series\") # title of graph"]},{"cell_type":"markdown","metadata":{"id":"PBPcQXmeWA39"},"source":["**What do you observe?** Write a few sentences considering these 2 questions:<br>\n","> 1. How do highways affect NO$_{2}$ concentrations?\n","> 2. What are some policy actions that have been taken to try to reduce traffic-related NO and NO$_{2}$ emissions?"],"id":"PBPcQXmeWA39"},{"cell_type":"markdown","source":["**Your answer:**<br>\n","Double-click on this cell and replace this text with your response."],"metadata":{"id":"QIxtpRfNWKQv"},"id":"QIxtpRfNWKQv"},{"cell_type":"markdown","id":"82ddb108","metadata":{"id":"82ddb108"},"source":["***\n","##3. The Weekend Effect"]},{"cell_type":"markdown","id":"816ecac3","metadata":{"id":"816ecac3"},"source":["We will now investigate the *Weekend Effect* at each of these sites. We will plot how NOx concentrations change throughout the day at both Laney and San Pablo on the weekends and weekdays.\n","\n","In the 2 cells below, we use **DateTime** which is built into pandas. DateTime has attributes `.time` and `.day_name` which we can use to extract those corresponding values from the `timestamp` column, which is in DateTime format. Knowing the day of the week and the hour of the day will allow us to more easily identify weekdays and weekends.\n","<br><br>\n","The code cell below creates 2 new columns in the `data_close` DataFrame called **`day_of_week`** and **`hour`**."]},{"cell_type":"code","execution_count":null,"id":"f42066e5","metadata":{"id":"f42066e5"},"outputs":[],"source":["data_close['day_of_week'] = data_close.index.day_name()\n","data_close['hour'] = data_close.index.time\n","data_close.head(5)"]},{"cell_type":"code","execution_count":null,"id":"05a22fd1","metadata":{"id":"05a22fd1"},"outputs":[],"source":["data_far['day_of_week'] = data_far.index.day_name()\n","data_far['hour'] = data_far.index.time\n","data_far.head(5)"]},{"cell_type":"markdown","id":"73533c30","metadata":{"id":"73533c30"},"source":["Now both `data_close` and `data_far` have the 2 new columns added. We will now separate the DataFrames into weekend and weekday data.\n","\n","###3.1 Splitting DataFrames into Weekend/Weekdays\n","\n","*The code in the cell below is more advanced than you need to know. <br>Optional: `|` is a representation of the [\"or\" operator](https://realpython.com/python-or-operator/) which is a boolean operation used in the code cell below.*<br>\n","**Run the cell below.**"]},{"cell_type":"code","execution_count":null,"id":"a2ae937f","metadata":{"id":"a2ae937f"},"outputs":[],"source":["# Run this cell selecting weekdays\n","close_weekdays = data_close[(data_close['day_of_week']=='Monday') |(data_close['day_of_week']=='Tuesday') | (data_close['day_of_week']=='Wednesday') | (data_close['day_of_week']=='Thursday') | (data_close['day_of_week']=='Friday')]\n","close_weekdays.head(3)"]},{"cell_type":"markdown","source":["^ **`close_weekdays`** includes the rows of `data_close` (Laney site) with data collected on a *weekday*."],"metadata":{"id":"7PAQWjBHYlda"},"id":"7PAQWjBHYlda"},{"cell_type":"code","execution_count":null,"id":"0c22c630","metadata":{"id":"0c22c630"},"outputs":[],"source":["# Run this cell selecting weekdays\n","far_weekdays = data_far[(data_far['day_of_week']=='Monday') |(data_far['day_of_week']=='Tuesday') | (data_far['day_of_week']=='Wednesday') | (data_far['day_of_week']=='Thursday') | (data_far['day_of_week']=='Friday')]\n","far_weekdays.head(3)"]},{"cell_type":"markdown","source":["^ **`far_weekdays`** includes the rows of `data_far` (San Pablo site) with data collected on a *weekday*."],"metadata":{"id":"tkRWwcbEZqKw"},"id":"tkRWwcbEZqKw"},{"cell_type":"code","execution_count":null,"id":"86871808","metadata":{"id":"86871808"},"outputs":[],"source":["# Run this cell selecting weekends\n","close_weekends = data_close[(data_close['day_of_week']=='Saturday') |(data_close['day_of_week']=='Sunday')]\n","close_weekends.head(3)"]},{"cell_type":"markdown","source":["^ **`close_weekends`** includes the rows of `data_close` (Laney site) with data collected on *weekends*."],"metadata":{"id":"4TdVZJcCZTei"},"id":"4TdVZJcCZTei"},{"cell_type":"code","execution_count":null,"id":"7d4c3bb1","metadata":{"id":"7d4c3bb1"},"outputs":[],"source":["# Run this cell selecting weekends\n","far_weekends = data_far[(data_far['day_of_week']=='Saturday') |(data_far['day_of_week']=='Sunday')]\n","far_weekends.head(3)"]},{"cell_type":"markdown","source":["^ **`far_weekends`** includes the rows of `data_far` (San Pablo site) with data collected on *weekends*."],"metadata":{"id":"iBAKpAAEZwaK"},"id":"iBAKpAAEZwaK"},{"cell_type":"markdown","id":"d090b989","metadata":{"id":"d090b989"},"source":["###3.2 Averaging Concentrations\n","\n","To look at the daily profile, we will average the concentrations across **each hour**.\n","\n","In the following cells, we use the function **`groupby`** to resort the information in our DataFrame. A translation of the first line of code below, `close_weekdays.groupby('hour').mean()`, would read \"We take the `close_weekdays` DataFrame and \"group by\" the *hour* values. This creates collections of rows with each unique hour value, then we find the mean (average) of each collection.\"\n","\n","*Optional/Advanced: `.mean()` is the \"aggregation function\" that is always required with the [groupby function](https://towardsdatascience.com/all-about-pandas-groupby-explained-with-25-examples-494e04a8ef56?gi=0cb29220a2d3).*<br> **Run the cell below. We repeat the groupby function call on each of the 4 DataFrames we've created thus far.**"]},{"cell_type":"code","execution_count":null,"id":"7d8919f3","metadata":{"id":"7d8919f3"},"outputs":[],"source":["## Finding average value for each unique hour in dataframe\n","# Repeated for each of the dataframes we've made\n","grouped_weekdays_close = close_weekdays.groupby('hour').mean(numeric_only=True)\n","grouped_weekdays_far = far_weekdays.groupby('hour').mean(numeric_only = True)\n","\n","grouped_weekends_close = close_weekends.groupby('hour').mean(numeric_only=True)\n","grouped_weekends_far = far_weekends.groupby('hour').mean(numeric_only=True)"]},{"cell_type":"markdown","source":["Ignore any \"FutureWarning\" that may arise.<br> Let's take a look at what one of these DataFrames look like now that they've been grouped and averaged by hour."],"metadata":{"id":"d3Fs4ns6dOl-"},"id":"d3Fs4ns6dOl-"},{"cell_type":"code","source":["grouped_weekends_far"],"metadata":{"id":"_OygdvMedcUz"},"id":"_OygdvMedcUz","execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["Notice that this DataFrame (and the other 3 grouped ones) have 24 rows that each represent one of the 24 hours in a day!"],"metadata":{"id":"ew4eAj9ndhlp"},"id":"ew4eAj9ndhlp"},{"cell_type":"markdown","id":"cf2a468c","metadata":{"id":"cf2a468c"},"source":["### 3.3 Plotting Concentrations\n","\n","\n","\n","Now that we have our data cleaned, we can plot the daily profiles of weekend and weekday concentrations at the sites near and far from the highway.\n","\n","Let's start with the site **NEAR the highway:** *Read through each line of the cell below to understand what makes the produced visualization.*"]},{"cell_type":"code","execution_count":null,"id":"4ddb6adf","metadata":{"id":"4ddb6adf"},"outputs":[],"source":["## Plotting the close to highway site:\n","plt.figure(figsize = (25, 8))\n","plt.plot(grouped_weekdays_close.index.astype('str'), grouped_weekdays_close['nox'], label = \"Weekdays\", color = 'blue') # plots grouped_weekdays_close\n","plt.plot(grouped_weekends_close.index.astype('str'), grouped_weekends_close['nox'], label = \"Weekends\", color = 'red') # plots grouped_weekends_close\n","plt.legend(fontsize = 20) # specifies what legend looks like\n","plt.xticks(fontsize = 10) # specifies how many x ticks for x-axis to have\n","plt.ylim(0, 40) # sets the range for the y axis\n","plt.xlabel(\"Time of Day\") # x-axis label\n","plt.ylabel(\"NOx Concentration (ppb)\") # y-axis label\n","plt.title(\"Near Highway: Weekday and Weekend Diurnal Profiles of NOx\"); # title label"]},{"cell_type":"markdown","id":"1bad52ba","metadata":{"id":"1bad52ba"},"source":["Now let's plot the site **FAR from the highway:** *Read through each line of the cell below to understand what makes the produced visualization.*"]},{"cell_type":"code","execution_count":null,"id":"68e76b01","metadata":{"id":"68e76b01"},"outputs":[],"source":["## Plotting the FAR from the highway site:\n","plt.figure(figsize = (25, 8))\n","plt.plot(grouped_weekdays_far.index.astype('str'), grouped_weekdays_far['nox'], label = \"Weekdays\", color = 'blue') # plots grouped_weekdays_far\n","plt.plot(grouped_weekends_far.index.astype('str'), grouped_weekends_far['nox'], label = \"Weekends\", color = 'red') # plots grouped_weekends_far\n","plt.legend(fontsize = 25) # specifies what legend looks like\n","plt.xticks(fontsize = 10) # specifies how many x ticks for x-axis to have\n","plt.ylim(0, 40) # sets the range for the y axis\n","plt.xlabel(\"Time of Day\") # x-axis label\n","plt.ylabel(\"NOx Concentration (ppb)\") # y-axis label\n","plt.title(\"Far from Highway: Weekday and Weekend Diurnal Profiles of NOx\"); # title label"]},{"cell_type":"markdown","id":"accf9556","metadata":{"id":"accf9556"},"source":["**What do you observe?**<br>Write a few sentences analyzing how the highway influences the Weekend Effect based on the two graphs produced above. Can you see a bigger difference in weekend and weekday NOx concentrations at the near highway site or far from highway site?"]},{"cell_type":"markdown","source":["**Your answer:**<br>\n","Double-click here and replace this text with your response."],"metadata":{"id":"voslabyfeugx"},"id":"voslabyfeugx"},{"cell_type":"markdown","metadata":{"id":"MJ6K-oPKjhIR"},"source":["**Consider this**<br>Here we have investigated how NO and NO$_{2}$ (NOx) concentrations change from weekday to weekend. Ozone (O$_{3}$) is a pollutant affected by NOx concentrations. Do a Google search on how O$_{3}$ concentrations change from weekday to weekends, and summarize your findings in a few sentences below."],"id":"MJ6K-oPKjhIR"},{"cell_type":"markdown","source":["**Your answer:**<br>\n","Double-click here and replace this text with your response."],"metadata":{"id":"zPI5usKKjjpC"},"id":"zPI5usKKjjpC"},{"cell_type":"markdown","source":["***\n","#### You've finished with the **Air Pollutant Exposure *In Class* notebook** and are ready to begin the **Air Polluntant Exposure *Student Exploration* notebook**! Good job!"],"metadata":{"id":"jR0b0yEpfMgA"},"id":"jR0b0yEpfMgA"}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.7"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}