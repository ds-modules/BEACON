{"cells":[{"cell_type":"markdown","id":"b7b6f521","metadata":{"id":"b7b6f521"},"source":["\n","# **BEACO$_{2}$N Notebook 5b: CO Concentrations and the COVID-19 Shutdown**\n","\n","\n","Notebook developed by: *Arushi Sharma, Skye Pickett, Alec Morgan, Lan Dinh, Su Min Park, Amy Castillo, Anna Winter, Ron Cohen*\n","\n","**Contact:** anna_winter@berkeley.edu"]},{"cell_type":"markdown","metadata":{"id":"uv0w0xTKIH2b"},"source":["### Learning Outcomes\n","Working through this notebook, you will learn about:\n","1. How CO concentrations changed during the COVID-19 shutdown\n","1. Separating data in DataFrames by date\n","1. Extracting information from a DateTime index\n","1. Grouping data and creating a summary statistic\n"],"id":"uv0w0xTKIH2b"},{"cell_type":"markdown","source":["## Table of Contents\n","1. Notebook Setup\n","1. Data Manipulation\n","1. Visualizing CO Concentrations by Time of Day\n","\n","\n","\n","*Note: In this notebook, there are some more advanced topics that are \"optional\". This means you can just read over these sections; don't worry about fully understanding these parts unless you are really interested. They may be useful later in the course, but for now they are not necessary, so feel free to just skim the parts labelled \"Optional\"!*"],"metadata":{"id":"0uUODjhXNkdc"},"id":"0uUODjhXNkdc"},{"cell_type":"markdown","source":["<hr style=\"border: 2px solid #003262\">\n","<hr style=\"border: 2px solid #C9B676\">"],"metadata":{"id":"kOt2F9QSjZp6"},"id":"kOt2F9QSjZp6"},{"cell_type":"markdown","id":"75b5be11","metadata":{"id":"75b5be11"},"source":["##1. Notebook Setup\n","In the *In Class* notebook, we explored how highways affect NO and NO$_{2}$ concentrations. Now, you will get a chance to explore how the Shelter in Place (SIP) order during the COVID-19 Pandemic affected CO concentrations in the Bay Area."]},{"cell_type":"markdown","source":["#### Loading in packages"],"metadata":{"id":"EAf1fkAyOJVj"},"id":"EAf1fkAyOJVj"},{"cell_type":"markdown","metadata":{"id":"cb55ca8d"},"source":["Python requires us to load packages. We'll be using the same packages we loaded in the *In Class* notebook that we went through together. However, since this is a separate notebook, we need to load them in again. **Run the cell below.**"],"id":"cb55ca8d"},{"cell_type":"code","execution_count":null,"id":"99aa012c","metadata":{"id":"99aa012c"},"outputs":[],"source":["#Run this cell\n","\n","# Used for visualizations\n","import matplotlib\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","\n","# Numerical computation\n","import numpy as np\n","from decimal import Decimal\n","\n","# Manipulating data in form of series or dataframes\n","import pandas as pd\n","\n","# Manipulating fields that are date or time\n","import datetime\n","from datetime import time"]},{"cell_type":"markdown","source":["Since we're going to be creating visualizations in this notebook, it can be easiest to set some parameters in advance. Consider this like setting the stage for a show, so everything will be shown in the same view. **Run the cell below.** If any warning pops up, press \"run anyway\".\n","\n","If you get any error saying \"matplotlib is not defined\", that means you haven't run the cell above this. Run that one *first* then the one below next."],"metadata":{"id":"1WDHI2wRs7id"},"id":"1WDHI2wRs7id"},{"cell_type":"code","execution_count":null,"id":"9ec88c97","metadata":{"id":"9ec88c97"},"outputs":[],"source":["# Using this cell, we will be defining some matplotlib parameters for the plots that we would be creating.\n","\n","matplotlib.rcParams['axes.linewidth'] = 1\n","matplotlib.rcParams['lines.linewidth'] = 3\n","matplotlib.rcParams['ytick.labelsize'] = 20\n","matplotlib.rcParams['xtick.labelsize'] = 20\n","matplotlib.rcParams['axes.titlesize'] = 20\n","matplotlib.rcParams['axes.labelsize'] = 20\n","plt.rcParams['figure.figsize'] = [20, 14]\n","plt.rcParams[\"axes.labelweight\"] = \"bold\"\n","np.set_printoptions(suppress=True)\n","plt.rcParams[\"axes.labelweight\"] = \"bold\"\n","plt.rcParams[\"savefig.facecolor\"]= '#FFFFFF'"]},{"cell_type":"markdown","id":"4941d16e","metadata":{"id":"4941d16e"},"source":["**We will now look at data from a BEACO$_{2}$N node located on the Exploratorium in San Francisco.**<br> Run the cell below to import the data and save it to a DataFrame called **`data`**."]},{"cell_type":"code","execution_count":null,"id":"e512696f","metadata":{"id":"e512696f"},"outputs":[],"source":["# Run this cell\n","## Loading in the BEACO2N data\n","filename =\"https://github.com/wintera71/BEACO2N-Modules/raw/refs/heads/main/Lesson%205:%20Air%20Pollutant%20Exposure/CSVs/co_covid_data.csv\"\n","data = pd.read_csv(filename, on_bad_lines='skip', index_col = [0], parse_dates=[0])\n","data.head(5)"]},{"cell_type":"markdown","source":["Recall from the Introduction to Pandas notebook, we can use the `.head(n)` method to see the first `n` rows of our DataFrame. <br>**Q1: In the cell below, write code to display the first *10* rows of the `data` DataFrame.**"],"metadata":{"id":"Dkv_S42SHaW-"},"id":"Dkv_S42SHaW-"},{"cell_type":"code","execution_count":null,"id":"15f3128f","metadata":{"id":"15f3128f"},"outputs":[],"source":["## Q1 Your code here"]},{"cell_type":"markdown","id":"ff0a9faa","metadata":{"id":"ff0a9faa"},"source":["***\n","##2. Data Manipulation\n","\n","###2.1 Separating Data Before and After Shelter In Place Order\n","\n","We now want to filter our DataFrame into **2 separate periods**: one period *before* the Shelter in Place (SIP) order, and one period *after* the SIP order was made. Let's consider the 6 weeks before the order (2/2/20-3/14/20), and the 6 weeks during the order (3/22/20-5/2/20).\n","\n","\n","**Create two dataframes:**\n","\n","* **Q2:** Create DataFrame **`before_sip`**, filtering the dates of the `data` dataframe from **2020-02-02** to **2020-03-14**\n","\n","* **Q3:** Create DataFrame **`during_sip`**, filtering the dates of the `data` dataframe from **2020-03-22** to **2020-05-02**\n","\n","We can use the `[ ]` operator to grab rows according to their row index label. All we have to do is specify which starting index label (timestamp) we want to start at and the last index label (timestamp). We write a colon (`:`) in between the indices; this denotes to grab all of the rows in between the start and end index (*not* including the value at the end index).\n",">  *Hints:* <br> - The first line of code for Q2 should *start* like this:<br> `before_sip = data[\"2020-02-02 00:00:00\" : `<br> - It can be helpful to copy and paste values from the DataFrame (above) to avoid typos!"]},{"cell_type":"code","execution_count":null,"id":"d4e551ea","metadata":{"id":"d4e551ea"},"outputs":[],"source":["## Q2: before_sip DataFrame (dates before the SIP order)\n","## Your Code Here\n","\n","before_sip = ..."]},{"cell_type":"code","execution_count":null,"id":"5b89cd62","metadata":{"id":"5b89cd62"},"outputs":[],"source":["## Q3: during_sip DataFrame (dates during the SIP order)\n","## Your Code Here\n","\n","during_sip = ..."]},{"cell_type":"markdown","id":"48471448","metadata":{"id":"48471448"},"source":["We are interested in the **daily profile** of concentrations during these 2 time periods. To look at this, we need to add an `hour` column to each of the new DataFrames.\n","\n","To achieve this, we have to access the time from the `timestamp` index column. Since our index is a `DateTime` object, it has various attributes that can give us information like date, time, timezone, etc."]},{"cell_type":"markdown","source":["If we want a certain attribute from the `DateTime`, like the date only, we can add **`.date`** after to extract *just the date*!\n","\n","In our DataFrames, the *index* is the column that contains type `datetime`, so we can call `<dataframe_name>.index` to get the index (*DateTime* in our case), and then add `.date` to get the date. This is shown in the cell below:\n",">*We used [0:10] to show just the first 10 items of the array, since the DataFrame has 982 rows and thus the array is 982 items long.*"],"metadata":{"id":"t5-mYYmQns0J"},"id":"t5-mYYmQns0J"},{"cell_type":"code","source":["# To find the date of our before_sip DataFrame\n","before_sip.index.date[0:10]"],"metadata":{"id":"z00NwwjOoPtr"},"id":"z00NwwjOoPtr","execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["###2.2 Extracting Hours\n","\n","Now, it's your turn to practice using the attributes of `datetime`. <br>\n","**Q4:** **Add a column called `hour` to `before_sip` that shows the `.time` attribute.** Use the same logic as above, this time using `.time` instead of `.date`."],"metadata":{"id":"bhhyxH9eofQ3"},"id":"bhhyxH9eofQ3"},{"cell_type":"code","execution_count":null,"id":"bac77967","metadata":{"id":"bac77967"},"outputs":[],"source":["## Q4 answer here\n","\n","\n","# If you get a \"SettingWithCopyWarning\", you can ignore it for now!"]},{"cell_type":"markdown","source":["**Q5:** **Like in Q4, add a column called `hour` to `during_sip` that shows the `.time` attribute.** Use the same logic as above, this time using `.time` instead of `.date`."],"metadata":{"id":"Sa43qTY7qYoj"},"id":"Sa43qTY7qYoj"},{"cell_type":"code","source":["## Q5 answer here\n","\n","\n","\n","# If you get a \"SettingWithCopyWarning\", you can ignore it for now!"],"metadata":{"id":"Z6QJkOt0qY-I"},"id":"Z6QJkOt0qY-I","execution_count":null,"outputs":[]},{"cell_type":"markdown","id":"443bb9c8","metadata":{"id":"443bb9c8"},"source":["Let's take a look at our two DataFrames now that you've added the new column for each!<br>\n","*If you don't see a `hour` column, make sure you've run the cells above and that you're adding the column correctly.*"]},{"cell_type":"code","execution_count":null,"id":"04d67132","metadata":{"id":"04d67132"},"outputs":[],"source":["before_sip.head()"]},{"cell_type":"code","execution_count":null,"id":"a4a04e15","metadata":{"id":"a4a04e15"},"outputs":[],"source":["during_sip.head()"]},{"cell_type":"markdown","id":"4cb6ffd3","metadata":{"id":"4cb6ffd3"},"source":["###2.3 Average CO Concentration by Hour\n","Let's look at the average CO concentration for each hour of the day. To do this, we can use the **`.groupby(<column_name>).mean()`** command that we used in the *In Class* notebook!\n","\n","We can select whichever column we would like to group by. The column name will go inside of the `( )` after the groupby command.\n","\n","**Q6: Fill in the correct column in the groupby command.**"]},{"cell_type":"code","execution_count":null,"id":"84154d4e","metadata":{"id":"84154d4e"},"outputs":[],"source":["# Select the column from the before_sip dataframe to put in the command\n","\n","grouped_before_sip = before_sip.groupby(...).mean()"]},{"cell_type":"markdown","source":["In the cell below, we'll see the DataFrame created from the code above.<br>**Check your answer:** *There should be 24 rows (1 per hour), 2 columns (`hour` and `co`), and the values in the first row should be `00:00:00` for `hour` and `0.212131` for `co`.*"],"metadata":{"id":"gueUj6kJQBS8"},"id":"gueUj6kJQBS8"},{"cell_type":"code","execution_count":null,"id":"21e46ba3","metadata":{"id":"21e46ba3"},"outputs":[],"source":["grouped_before_sip"]},{"cell_type":"markdown","source":["Let's do the same thing for the during_sip dataframe. <br>**Q7:** **Fill in the correct column in the command below (the same one as for `before_sip`!).**"],"metadata":{"id":"9eGyDwTxOhv0"},"id":"9eGyDwTxOhv0"},{"cell_type":"code","execution_count":null,"id":"df779839","metadata":{"id":"df779839"},"outputs":[],"source":["# Select the column from the during_sip dataframe to put in the command\n","\n","grouped_during_sip = during_sip.groupby(...).mean()"]},{"cell_type":"markdown","source":["**Check your answer:** *There should be 24 rows (1 per hour), 2 columns (hour and co), and the values in the first row should be `00:00:00` for `hour` and `0.150585` for `co`.*"],"metadata":{"id":"tNdScuE5Rnk1"},"id":"tNdScuE5Rnk1"},{"cell_type":"code","source":["grouped_during_sip"],"metadata":{"id":"Ozd4l7BERtE-"},"id":"Ozd4l7BERtE-","execution_count":null,"outputs":[]},{"cell_type":"markdown","id":"3ffc80dc","metadata":{"id":"3ffc80dc"},"source":["***\n","##3. Visualizing CO Air Pollution by Time of Day\n","\n","Now let's plot the data! We'll plot the CO daily profile for both before the SIP order and during the SIP order. Run the cell below and read through the code. In this section, we'll focus on analysis."]},{"cell_type":"code","source":["plt.figure(figsize = (25, 8)) # makes size of plot\n","\n","plt.plot(grouped_before_sip.index.astype(str), grouped_before_sip['co'], label= \"Before SIP\") # plots grouped_before_sip\n","plt.plot(grouped_during_sip.index.astype(str), grouped_during_sip['co'], label=\"During SIP\") # plots grouped_during_sip\n","\n","plt.legend(fontsize = 18) # specifies what legend looks like\n","plt.grid() # adds a grid to make your visual analyses easier and more accurate\n","\n","# Adds a x-axis label\n","plt.xlabel(\"Time of Day\")\n","\n","# Adds a y-axis label\n","plt.ylabel(\"CO (ppm)\")\n","\n","# Adds a title to our line plot\n","plt.title(\"Daily Profile of CO Concentrations\")\n","\n","# Specifies font size of x labels and rotates labels so they don't overlap\n","plt.xticks(fontsize = 15, rotation = 45);"],"metadata":{"id":"f_TILpk8zoLM"},"id":"f_TILpk8zoLM","execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["What do you observe? Look at the plot above to answer each of the following questions:<br>\n","\n","> **Q8:** Are the CO values higher before or during the SIP order?\n","\n","\n","> **Q9:** What are the maximum and minimum CO values (in ppm) for both time periods?\n","\n","> **Q10:** Why do you think we see this difference?"],"metadata":{"id":"IXnbxOxhPAjA"},"id":"IXnbxOxhPAjA"},{"cell_type":"markdown","source":["**YOUR ANSWERS HERE:** Double-click to edit this cell.<br>\n","*   **Q8:** (Your answer here)\n","*   **Q9:** (Your answer here)\n","*   **Q10:** (Your answer here)"],"metadata":{"id":"08sUA8jyuTTB"},"id":"08sUA8jyuTTB"},{"cell_type":"markdown","metadata":{"id":"MJ6K-oPKjhIR"},"source":["**Consider this**<br> In the *In Class* and *Student Exploration* notebooks, we've explored how traffic and highways affect various pollutants. However, the effects of this pollution are not experienced equally across all communities. Use the internet to investigate: Which populations are most affected by traffic-related air pollution, and why?"],"id":"MJ6K-oPKjhIR"},{"cell_type":"markdown","source":["**Your answer:**<br>\n","Double-click here and replace this text with your response."],"metadata":{"id":"zPI5usKKjjpC"},"id":"zPI5usKKjjpC"},{"cell_type":"markdown","source":["***\n","##4. Conclusion\n","In this notebook, you learned about:\n","- Splitting data using timestamps and filtering\n","- Understanding pollutant concentrations during 2 time periods\n","- Using groupby to average and group data\n","- Analyzing multiple line plots\n","\n","#### You've finished the **Air Pollutant Exposure *Student Exploration* notebook**. Good job! Congratulations on finishing the **Air Pollutant Exposure** lesson!"],"metadata":{"id":"O-u1RRN9Quzi"},"id":"O-u1RRN9Quzi"},{"cell_type":"markdown","source":["***\n","***"],"metadata":{"id":"A1hUBPTmQ3Y5"},"id":"A1hUBPTmQ3Y5"}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.7"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}